// ×‘×“×™×§×” ×¢×œ ×”×“×•×’××” ×”×××™×ª×™×ª ××”×ª××œ×•×œ

// ×¤×•× ×§×¦×™×” ×œ×”×¡×¨×ª ×—×–×¨×•×ª ×©×œ ×‘×™×˜×•×™×™×/××©×¤×˜×™× ×©×—×•×–×¨×™× 5+ ×¤×¢××™×
function removeExtremeRepetitions(text) {
  if (!text) return text;

  console.log('ğŸ” Checking for extreme repetitions...');

  // ×”×¡×¨ ×—×–×¨×•×ª ×©×œ ×‘×™×˜×•×™×™× (2-15 ××™×œ×™×) ×©×—×•×–×¨×™× 5+ ×¤×¢××™×
  let cleaned = text;

  for (let wordCount = 2; wordCount <= 15; wordCount++) {
    const pattern = new RegExp(`((?:\\S+\\s+){${wordCount-1}}\\S+)(?:\\s+\\1){4,}`, 'gi');

    cleaned = cleaned.replace(pattern, (match, capturedPhrase) => {
      const repetitionCount = (match.match(new RegExp(escapeRegex(capturedPhrase), 'gi')) || []).length;
      console.log(`âš ï¸ Found extreme repetition: "${capturedPhrase}" repeated ${repetitionCount} times - keeping only 1`);
      return capturedPhrase;
    });
  }

  return cleaned;
}

function escapeRegex(string) {
  return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

// ×”×˜×§×¡×˜ ×”×××™×ª×™ ××”×ª××œ×•×œ (×”×—×œ×§ ×”×‘×¢×™×™×ª×™)
const problemText = `×–×” ×›×œ ×”×–××Ÿ ×œ×”×’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£, ×¢×“ ×”×¡×•×£, ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£. ×–×” ×”×™×” ××’×™×¢ ×¢×“`;

console.log('ğŸ“ BEFORE cleaning:');
console.log(`Length: ${problemText.length} characters`);
console.log(`First 200 chars: ${problemText.substring(0, 200)}...`);
console.log(`Last 200 chars: ...${problemText.substring(problemText.length - 200)}`);

console.log('\nğŸ§¹ APPLYING removeExtremeRepetitions...\n');

const cleaned = removeExtremeRepetitions(problemText);

console.log('\nğŸ“ AFTER cleaning:');
console.log(`Length: ${cleaned.length} characters`);
console.log(`Result: ${cleaned}`);

console.log('\nğŸ“Š SUMMARY:');
console.log(`Original length: ${problemText.length} characters`);
console.log(`Cleaned length: ${cleaned.length} characters`);
console.log(`Reduction: ${problemText.length - cleaned.length} characters (${((problemText.length - cleaned.length) / problemText.length * 100).toFixed(1)}%)`);

// ×‘×“×•×§ ×× ×”×˜×§×¡×˜ ×”×˜×•×‘ × ×©××¨
const hasGoodContent = cleaned.includes('×–×” ×›×œ ×”×–××Ÿ ×œ×”×’×™×¢ ×¢×“ ×”×¡×•×£');
const hasProblematicRepetition = (cleaned.match(/×–×” ×”×™×” ××’×™×¢ ×¢×“ ×”×¡×•×£/g) || []).length > 5;

console.log('\nâœ… SAFETY CHECK:');
console.log(`Good content preserved: ${hasGoodContent ? 'YES' : 'NO'}`);
console.log(`Still has problematic repetitions: ${hasProblematicRepetition ? 'YES' : 'NO'}`);