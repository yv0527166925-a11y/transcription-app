// העתק את הפונקציה המתוקנת מהשרת
function testQuotationFix() {
  let text = `למה התורה כותבת"המצוות שאדם דש"?  אתה שואל אותו"מה?", אתה שואל אותם"מה?" ישראל"מאפטא`;

  console.log('לפני תיקון:');
  console.log(text);

  // תיקון קיצורים עבריים נפוצים עם רווחים תקינים
  text = text
    .replace(/רש\s*["\u0022\u201C\u201D]\s*י/g, 'רש"י')
    .replace(/חז\s*["\u0022\u201C\u201D]\s*ל/g, 'חז"ל')
    .replace(/החיד\s*["\u0022\u201C\u201D]\s*א/g, 'החיד"א')
    .replace(/הגר\s*["\u0022\u201C\u201D]\s*א/g, 'הגר"א')
    .replace(/רמב\s*["\u0022\u201C\u201D]\s*ם/g, 'רמב"ם')
    .replace(/רמב\s*["\u0022\u201C\u201D]\s*ן/g, 'רמב"ן')
    .replace(/משנ\s*["\u0022\u201C\u201D]\s*ב/g, 'משנ"ב')
    .replace(/שו\s*["\u0022\u201C\u201D]\s*ע/g, 'שו"ע')
    .replace(/שו\s*["\u0022\u201C\u201D]\s*ת/g, 'שו"ת')
    .replace(/מהר\s*["\u0022\u201C\u201D]\s*ל/g, 'מהר"ל')

    // תיקון גרשיים וציטוטים מתקדם - פתרון חזק וסופי
    // שלב 1: נקה סוגי גרשיים שונים לאחיד
    .replace(/["\u0022\u201C\u201D]/g, '"')

    // שלב 2: הוסף רווחים לפני גרשיים שצמודים למילים עבריות
    .replace(/([א-ת])"([א-ת])/g, '$1 "$2')          // כותבת"המצוות -> כותבת "המצוות

    // שלב 3: תקן גרשיים שיש להם רווח מיותר לפני הם
    .replace(/([א-ת])\s{2,}"([א-ת])/g, '$1 "$2')   // רווחים כפולים

    // שלב 4: תקן גרשיים עם פיסוק - צמוד למילה לפני הפיסוק
    .replace(/([א-ת])"([.,!?])/g, '$1"$2')          // מילה"? -> מילה"?

    // שלב 5: תקן תחילת ציטוטים
    .replace(/\s"([א-ת])/g, ' "$1')                 // רווח לפני גרשיים פותחים
    .replace(/^"([א-ת])/gm, '"$1')                  // תחילת שורה

    // תיקון פיסוק חזק יותר - הסרת רווחים לפני פיסוק
    .replace(/\s+([.,!?:;])/g, '$1')                           // הסר כל רווח לפני פיסוק
    .replace(/([.,!?:;])\s+/g, '$1 ')                          // רווח יחיד אחרי פיסוק

    // תיקון פיסוק עם מילים עבריות
    .replace(/([א-ת])([.,!?:;])([א-ת])/g, '$1$2 $3')          // רווח אחרי פיסוק בין מילים עבריות

    // ניקוי רווחים מיותרים
    .replace(/\s{2,}/g, ' ')                                   // רווחים כפולים לרווח יחיד
    .replace(/^\s+|\s+$/gm, '')                                // רווחים בתחילת/סוף שורות
    .trim();

  console.log('\nאחרי תיקון:');
  console.log(text);

  console.log('\nתוצאה צפויה:');
  console.log('למה התורה כותבת "המצוות שאדם דש"? אתה שואל אותו "מה?", אתה שואל אותם "מה?" ישראל "מאפטא');
}

testQuotationFix();