const fs = require('fs');
const path = require('path');
const JSZip = require('jszip');

function escapeXml(text) {
  return text
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#39;');
}

function fixHebrewPunctuation(text) {
  text = text.replace(/\."/g, '".');
  text = text.replace(/,"/g, '",');
  text = text.replace(/;"/g, '";');
  return text;
}

async function createDocumentFromRawText() {
  try {
    const templatePath = path.join(__dirname, '×—×–×¨ ××”×©×¨×ª ×ª×§×™×Ÿ 2.docx');
    const outPath = path.join(__dirname, 'parshat-ki-tavo-raw-text.docx');

    // ×”×˜×§×¡×˜ ×”×’×•×œ××™ ×©×œ ×”××©×ª××©
    let rawText = `×›×œ ×”×œ×©×•×Ÿ, ×›×œ ×”×ª×•×¨×” ×‘×›×œ ××§×•×. ×©×œ×•× ×•×‘×¨×›×” ××•×¨×™×™ ×•×¨×‘×•×ª×™×™, ××ª×—×™×œ×™× ××ª ×”×©×™×¢×•×¨ ×©×œ ×¤×¨×©×ª ×›×™ ×ª×‘×•× ×ª×©×¤"×”. ×•×”×™×” ×›×™ ×ª×‘×•× ××œ ×”××¨×¥ ××©×¨ ×”×©× ××œ×•×§×™×š × ×•×ª×Ÿ ×œ×š × ×—×œ×” ×•×™×¨×©×ª×” ×•×™×©×‘×ª×” ×‘×”. ×•×œ×§×—×ª ××¨××©×™×ª ×›×œ ×¤×¨×™ ×”××“××” ××©×¨ ×ª×‘×™× ×××¨×¦×š ××©×¨ ×”×©× ××œ×•×§×™×š × ×•×ª×Ÿ ×œ×š ×•×©××ª ×‘×˜× ×. ××” ××•××¨ ×¨×©"×™? ××” ×–×” ×•×œ×§×—×ª ××¨××©×™×ª ×›×œ ×¤×¨×™ ×”××“××”? ××” ××•××¨ ×¨×©"×™? ××•××¨ ×¨×©"×™, ×™×•×¨×“ ××“× ×™×•×¨×“ ××“× ×œ×ª×•×š ×©×“×”×• ×•×¨×•××” ×ª×× ×” ×©×‘×§×¨×”, ×›×•×¨×š ×¢×œ×™×” ×’××™ ×œ×¡×™××Ÿ, ×•××•××¨, ×”×¨×™ ×–×” ×‘×™×›×•×¨×™×. ××– ×‘×¢×¦× ××“×•×‘×¨ ×¢×œ ×ª×× ×”. ××– ×œ××” ×›×ª×•×‘ ××¨××©×™×ª ×›×œ ×¤×¨×™ ×”××“××”? ××”? ×œ××”? ××– ××– ×ª×’×™×“ ×¤×¨×™ ×”×¢×¥, ×œ× ×¤×¨×™ ×”××“××”. ××”? ×©×‘×— ××¨×¥ ×™×©×¨××œ, × ×•. ××ª×” ×œ× ×›×•×ª×‘ ××¨×–, ××ª×” ××•××¨ ×¤×¨×™ ×”××“××”. ××– ×™×© ×›××œ×” ××•××¨×™×, ×‘×¡×“×¨, ××‘×œ ×”×¨×™ ×× ××ª×” ××‘×¨×š ×‘×•×¨× ×¤×¨×™ ×”××“××” ×¢×œ ×‘×•×¨× ×¤×¨×™ ×”×¢×¥, ××– ×™×¦××ª ×™×“×™ ×—×•×‘×”. ××‘×œ ×”×—×™×“"×• ×œ× ××§×‘×œ ××ª ×”×ª×™×¨×•×¥ ×”×–×”, ×•×”×—×™×“"×• ××•××¨, ×”×—×™×“"×• ××•××¨, ×©×× ×™ ××•××¨ ×ª×•×“×” ×¨×‘×” ×’× ×¢×œ ×”××“××”. ×œ×›×Ÿ ×¤×¨×™ ×”××“××”. ×•×œ×›×Ÿ ×–×” ××•××¨×™× ×¢×œ ×¤×¨×™ ×”××“××” ×•×œ× ×¤×¨×™ ×”×¢×¥ ×›×“×™ ×œ×”×–×›×™×¨ ×’× ××ª ×”××“××” ×¢×¦××”. ×”×¨×‘ ××•×¨ ×”×—×™×™× ×”×§×“×•×© ××•××¨ ×©×™×© ×›××Ÿ ×¨××–, ×¨××– ×œ×¢× ×™×™×Ÿ ×©×œ ×”×‘×™××” ×œ×¢×•×œ× ×”×¢×œ×™×•×Ÿ ××—×¨×™ 120. ×•×”×™×” ×›×™ ×ª×‘×•× ××œ ×”××¨×¥ ××©×¨ ×”×©× ××œ×•×§×™×š × ×•×ª×Ÿ ×œ×š, ×œ×š × ×—×œ×”, ×–×” ×”×•×œ×š ×¢×œ ×”××¨×¥ ×”×¢×œ×™×•× ×”, ××—×¨×™ 120. ×•××– ××”? ×•×œ×§×—×ª ××¨××©×™×ª ×›×œ ×¤×¨×™ ×”××“××”. ××” ×–×” ×¨××©×™×ª ×›×œ ×¤×¨×™ ×”××“××”? ×¤×¨×™ ×”××“××”, ×¤×¨×™ ×”×¢×•×œ× ×”×–×”, ××” ×”×•×? ×”××¦×•×•×ª. ×¨××©×™×ª, ×”×›×•×•× ×” ×”××¦×•×•×ª ×”×›×™ ×˜×•×‘×•×ª ×©×¢×©×™×ª. ×•×¢× ×–×”, ×ª×‘×•× ×œ×¤× ×™ ×”×©×. ×•×œ××Ÿ ×ª×‘×•×? ××œ ×”×›×”×Ÿ. ××™ ×–×” ×”×›×”×Ÿ? ×¨×’×¢, ×œ×¤× ×™ ×›×Ÿ ×•×©××ª×” ×‘×˜× ×. ××” ×–×” ×•×©××ª×” ×‘×˜× ×? 60 ××¡×›×ª×•×ª. ×•×œ××” 60 ××¡×›×ª×•×ª? ××– ×”×•× ××•××¨, ×›×™ ×× ××“× ×¢×•×©×” ××ª ×”××¦×•×•×ª ×œ×¤×™ ××™×š ×©×—×–"×œ ×¤×™×¨×©×•, ×˜×•×‘ ×××•×“. ×•×× ×œ×, ×™×©×¨×£ ×”×•× ×•×”×. ×•××” ×–×” ×‘××ª ××œ ×”×›×”×Ÿ? ××– ×”×•× ××•××¨, ×–×” ×”×›×•×•× ×” ××™×›××œ. ××™×›××œ ×”××œ××š ×©×¢×•××“ ×•××§×¨×™×‘ × ×©××•×ª ×”×¦×“×™×§×™× ×œ×¤× ×™ ×”×§×“×•×© ×‘×¨×•×š ×”×•×. ×¢×•××“ ×•××§×¨×™×‘ × ×©××•×ª ×”×¦×“×™×§×™× ×œ×¤× ×™ ×”×§×“×•×© ×‘×¨×•×š ×”×•×, ×•×–×” ×”×›×•×•× ×” ×•××—×¨×™ ×–×”, ×•×¢× ×™×ª ×•×××¨×ª ×”×œ××”.

××—×¨×™ ×›×œ ×”×¢× ×™×™×Ÿ ×”×–×”, ××– ×‘× ××” ×¨×‘ ×©××—×” ×–×™×¡×œ ×–×™×•, ×”×¡×‘× ××§×œ×, ×”×•× ××•××¨, ×©×™××• ×œ×‘ ×‘×¢××•×“ 10. ××•××¨, ××“× ×©×¤× ×™×• ××•×¢×“×•×ª ×œ×©××—×ª ×—×ª×•× ×”, ×’× ×× ×”×“×¨×š ×¢×¦××” ××™× ×” ×§×œ×” ×•× ×•×—×”, ×”×¨×™ ×”×•× ×©××— ×•×˜×•×‘ ×œ×‘. ×›×™×•×¦× ×‘×–×”, ×”××“× ×‘×—×™×™×• ××ª×§×“× ×›×œ ×”×–××Ÿ ×œ×§×¨××ª ×”×¢×•×œ× ×”×‘×. ×•×œ×›×Ÿ, ×¢×œ×™×• ×œ×”×™×•×ª ×‘×©××—×”. ×•×× ××™× × ×• ×‘×©××—×”, ×”×¨×™ ×–×” ×¡×™××Ÿ ×©×™×© ×œ×• ×××” ×œ×—×©×•×©. ×× ×¢×œ ×¤×™ ×”××•×¨ ×”×—×™×™× ×”×§×“×•×© ×”×–×” ×©××“×‘×¨×™× ×¢×œ ××– ××” ××•××¨ ×”×¡×‘× ××§×œ×, ×›×œ ×”×œ×©×•×Ÿ ×× ××“× ×”×•×œ×š ×œ×—×ª×•× ×” ×©×œ ×”×‘×ª ×©×œ×•, ××¤×™×œ×• ×× ×“×•×¨×›×™× ×¢×œ×™×• ×•×–×” ×›×•××‘ ×œ×•, ×œ× ×§×¨×” ×›×œ×•×. ××– ×›×›×” ××•××¨ ×¦×¨×™×š ×œ×”×™×•×ª ×”×¢×•×œ× ×”×–×”. ×× ××“× ×™×•×“×¢ ×©×”×•× ×”×•×œ×š ×œ×§×¨××ª ×”×¢×•×œ× ×”×‘× ×•×”×•× ×”×•×œ×š ×œ××§×•× ×”×›×™ ×˜×•×‘, ××– ×”×“×¨×š ×’× ×¦×¨×™×›×” ×œ×”×™×•×ª ×‘×©××—×”. ×•×–×” ×•×–×” ×× ×œ× ×§×•×¨×”, ×¡×™××Ÿ ×© ×”××¦×‘ ×œ× ×˜×•×‘.

×“×¨×š ××’×‘, ×¢×›×©×™×• ×›×©×‘××ª×™ ×œ×¤×”, ×××¨ ×œ×™ ×”×¨×‘ ×™×¢×§×‘ ×™×©×¨××œ ×¤×”, ×–×” ×–×” ×©××¡×“×¨ ×¤×” ××ª ×” ××– ×”×•× ×××¨ ×œ×™ ×©×™×© ×‘×—×“×¨ ×§×¤×”, ×©×™×© ×‘×‘×™×ª ×›× ×¡×ª ×—×“×¨ ×§×¤×”. ××– ×”×™×” ×©× ×¤×ª×§ ×× ×œ×›×œ×›×ª, ×¡×™××Ÿ ×©××ª×” ××“×. ×× ×œ× × ×™×§×™×ª, ××ª×” ×œ× ×‘×Ÿ ××“×. ××– ××™×©×”×• ×××¨, ××•×ª×• ×”×“×‘×¨ ×œ×’×‘×™ ×”×—×•×“×© ××œ×•×œ. ×× ×¢×©×™×ª ×¢×‘×™×¨×•×ª, ×¡×™××Ÿ ×©××ª×” ×‘×Ÿ ××“×, ××‘×œ ×× ×œ× ×—×–×¨×ª ×‘×ª×©×•×‘×”, ×¡×™××Ÿ ×©××ª×” ×œ× ×‘×Ÿ ××“×. ×™×¤×”.

×•×‘××ª ××œ ×”×›×”×Ÿ ××©×¨ ×™×”×™×” ×‘×™××™× ×”×”× ×•×××¨×ª ××œ×™×•, ×•××—×¨×™ ×›×œ ××” ×©××ª×” ××•××¨, ××ª×” ××‘×§×© ××”×§×“×•×© ×‘×¨×•×š ×”×•×, ×”×©×§×™×¤×” ×××¢×•×Ÿ ×§×•×“×©×š ×”×©×§×™×¤×” ×××¢×•×Ÿ ×§×•×“×©×š ××Ÿ ×”×©××™×™× ×•×‘×¨×š ××ª ×¢××š ××ª ×™×©×¨××œ ×•××ª ×”××“××” ××©×¨ × ×ª×ª ×œ× ×•, ×›××©×¨ × ×©×‘×¢×ª ×œ××‘×•×ª×™× ×•, ××¨×¥ ×–×‘×ª ×—×œ×‘ ×•×“×‘×©. ×¢×›×©×™×•, ×‘××¤×¨×©×™× ×›×ª×•×‘ ×©×”×©×§×™×¤×” ×¤×™×¨×•×©×•, ××”, ×›××™×œ×• ×›×ª×•×‘ ×›××Ÿ ×‘××™×œ×” ×”×©×§×™×¤×” ×–×” ×©×ª×™ ××™×œ×™×. ×”×¡×§ ×™×¤×”. ×”×¡×§, ×©××“× ×œ×•×‘×© ×©×§, ×–×” ×™×¤×” ×œ×•, ×©×”×•× ×¢×•×©×” ×ª×©×•×‘×”. ×”×©××œ×” ×”×™×, ××– ××” ×–×” ×§×©×•×¨ ×œ×”×©×§×™×¤×” ×××¢×•×Ÿ ×§×•×“×©×š ××Ÿ ×”×©××™×™×? ××– ×¢×œ ×–×” ×›×•×ª×‘ ×”×’×‘×¢×ª ×©××•×œ, ×¨×‘ ×©××•×œ ×‘×¨×š, ××•××¨ ×”×’×‘×¢×ª ×©××•×œ, ×”×©×§×™×¤×” ×××¢×•×Ÿ ×§×•×“×©×š, ×¢×¡×§ ×™×¤×”, ××‘×œ ×‘×ª× ××™ ××—×“, ×©×¨×§ ×”×©× ×¨×•××” ××•×ª×•. ×× ××“× ×œ×•×‘×© ×©×§ ×•××¨××” ×œ×›×•×œ× ××ª ×”×©×§, ××– ×–×” ×œ× ××™×Ÿ ×‘×–×” ×›×œ×•×. ×›×Ÿ. ×××¨×• ×¢×œ ××—×“ ×©×¨×¦×” ×œ×”×ª×¤××¨, ××– ×”×•× ×××¨ ××”, ×ª×œ×š ×œ×—×“×¨ ×©×œ×™ ×‘ ×‘×¢×œ×™×™×ª ×”×’×’, ××™×¤×” ×©×× ×™ ×¢×•×©×” ×ª×™×§×•×Ÿ ×—×¦×•×ª, ××– ×©××”, ×‘×–×”, ××ª×—×ª ×œ×¡×¤×¨×™× ×©×œ ×”×§×‘×œ×” ×©×”×™×™× ×• ×œ×•××“ ×‘×œ×™×œ×”, ××– ××” ××– ×–×” ×”×›×•×•× ×”. ×”×¡×§ ×™×¤×”, ××‘×œ ×‘×ª× ××™ ×©×–×” ×”×©×§×™×¤×” ×××¢×•×Ÿ ×§×•×“×©×š ××Ÿ ×”×©××™×™×. ×©×¨×§ ×”×©× ×¨×•××” ××ª ×–×”.

×¢×›×©×™×• ×™×© ×›××Ÿ ××ª ×”×‘×¢×œ ×”×˜×•×¨×™× ×©×“×™×‘×¨× ×• ×¢×œ×™×• ×”××•×Ÿ ×¤×¢××™×, ×•×›×œ ×¤×¢× ×¦×¨×™×›×™× ×œ×—×–×•×¨ ×¢×œ×™×• ××—×“×©, ××¤× ×™ ×©×”×™×¦×¨ ×”×¨×¢ ×©×œ ×“×™×‘×•×¨×™× ×‘×ª×¤×™×œ×” ×”×•× × ×•×¨× ×•××™×•×. ××•××¨ ×‘×¢×œ ×”×˜×•×¨×™× ×‘×¤×¨×§ ×›"×• ×¤×¡×•×§ ×™"×˜, ×•×œ×ª×ª×š ×¢×œ×™×•×Ÿ ×¢×œ ×›×œ ×”×’×•×™×™× ××©×¨ ×¢×©×” ×œ×ª×”×™×œ×” ×•×œ×©× ×•×œ×ª×¤××¨×ª. ××•××¨ ×”×‘×¢×œ ×”×˜×•×¨×™×, ×œ×ª×”×™×œ×”, ×œ×©× ×•×œ×ª×¤××¨×ª, ×›×œ×•××¨, ××” ×©×™×©×¨××œ ××©×‘×—×™× ×•××”×œ×œ×™× ×œ×©×, ×”×•× ×œ×”× ×œ×ª×¤××¨×ª. ×•×”×™×™× ×• ×“×××¨×™× ×Ÿ, ×¢×ª×™×“ ×”×§×“×•×© ×‘×¨×•×š ×”×•× ×œ×”×™×•×ª ×¢×˜×¨×” ×‘×¨××© ×›×œ ×¦×“×™×§ ×•×¦×“×™×§. ×©××•×ª×” ×¢×˜×¨×” ×©××¢×˜×¨×™× ×œ×§×“×•×© ×‘×¨×•×š ×”×•× ×‘×ª×¤×™×œ×ª×, ××—×–×™×¨×” ×œ×”×. ××‘×œ, ××™ ×©×©×— ×©×™×—×ª ×—×•×œ×™×Ÿ ×‘×‘×™×ª ×”×›× ×¡×ª, ××§×™×¤×™× ×œ×• ×›×œ ×’×•×¤×• ×‘×§×•×¦×™×, ×œ×›×š ×©×™×¨ ×”×©×™×¨×™× ×œ×™×ª, ×•×›× ×’×“×• ×›×›×œ ×¢×©×™×¨×™×. ×“×™×‘×¨× ×• ×›×‘×¨ ×¢×œ ×”×‘×¢×œ ×”×˜×•×¨×™× ×”×–×” ×”×¨×‘×” ×¤×¢××™×. × ×“×‘×¨ ×¤×” ×¢×œ ×”×—×•××¨×” ×©×œ ×“×™×‘×•×¨×™× ×‘×‘×™×ª ×”×›× ×¡×ª.

××‘×œ ×”×©× ×” ×™×© ×œ× ×• ×—×™×“×•×© ×©×©×œ×— ×”×¨×‘ ×‘×Ÿ ×¦×™×•×Ÿ ×¡× ×”. ×”×•× ××‘×™× ×©×”×¨××‘"×, ×›×©×”×’×™×¢ ×œ××¦×¨×™×, ×”×—×œ×™×˜ ×œ×‘×˜×œ ××ª ×ª×¤×™×œ×ª ×”×¢××™×“×”. ×œ××”? ×›×™ ×”×•× ×¨××” ×‘×ª×¤×™×œ×ª ×”×¢××™×“×”. ×¨×§ ×”×©"×¥ ×™×’×™×“ ×‘×§×•×œ ×•×›×•×œ× ×™×ª×¤×œ×œ×• ××™×ª×•. ××– ×–××ª ××•××¨×ª, ×‘×™×˜×œ ××ª ×”×—×–×¨×”, ××‘×œ ×›×Ÿ. ×”×•× ×‘×™×˜×œ ××ª ×”×—×–×¨×”. ×•×œ××” ×”×•× ×‘×™×˜×œ? ×›×™ ×”×•× ×¨××” ×©××“×‘×¨×™×. ×™×•×©×‘×™× ××”××¨×¦×•×ª ×•×¢×•×©×™× ××” ×©×‘× ×œ×”×. ×‘×–×‘×•×– ×–××Ÿ. ×›×Ÿ, ×—×‘×œ ×¢×œ ×”×–××Ÿ ×”×–×”, ×”× ×™×›×•×œ×™× ×œ×”×¡×¤×™×§ ×›××” ×¢×¡×§×™× ×‘×™× ×ª×™×™×. ××– ×”×•× ×‘×™×˜×œ ××ª ×—×–×¨×” ××ª ×”×©"×¥. ××”? ××™×š ×–×” ×—×–×¨? ××™×š ×–×” ×—×–×¨? ×‘×“×•×¨×•×ª ×©××—×¨×™ ×”×¨××‘"× ×”×’×™×¢ ×œ×©××” ×¨×“×‘×–. ×•×”×¨×“×‘×– ×¨××” ×©×›×‘×¨ ×”×¡×™×‘×” ×©×œ ×”×ª×§× ×” ×™×¨×“×” ×•×”×™×” ×œ×• ×¢×•×“ ×¡×™×‘×•×ª ×›× ×¨××”, ×•×”×•× ×”×—×–×™×¨ ××ª ×–×”. ×”×¨×‘ ×¢×•×‘×“×™×” ×“×Ÿ ××” ×”×“×™×Ÿ ×‘××§×•××•×ª ×©××“×‘×¨×™×? ×”×× ×œ×‘×˜×œ ××ª ×—×–×¨×ª ×”×©"×¥? ×›×›×” ×”×•× ××‘×™× ×¤×” ×‘×¢××•×“ 22, ×©×”×¨×‘ ×¢×•×‘×“×™×” ×“×Ÿ ×‘×–×”. ×•×”×•× ×›×•×ª×‘ ×‘×©×•×˜ ×‘×©×•×˜ ×™×›×•×•×” ×“×¢×ª, ×××¨×™×š ×‘×–×” ×‘×˜×•×‘ ×˜×¢× ×•×“×¢×ª ×•××‘×™× ×¢×•×“ ××—×¨×•× ×™× ×¨×‘×™×, ×›×“×•×’××ª ×©×•×˜ ××™× ×—×™×™×, ×•×›×Ÿ ×“×‘×¨×™ ×¨×‘× ×• ×™×•×¡×£ ×—×™×™× ×‘×©×•×˜ ×‘ ×‘×©×•×˜ ×¤×¢×•×œ×ª ×¦×“×™×§, ×•×›×Ÿ ×‘×©×•×˜ ×”×©××™×™× ×”×—×“×©×™×, ×‘×©×•×˜ ×§×¨×™××ª ×—× ×” ×“×•×“, ×• ×§×™×¦×•×¨, ×›×œ ×”××§×•××•×ª ×”××œ×”, ×•××•×œ× ×‘×¡×•×£ ×”×•× ×›×•×ª×‘, ×”×¨×‘ ×¢×•×‘×“×™×”, ×•××•×œ× × ×¨××” ×©×’× ×”× ×œ× ×“×™×‘×¨×• ××œ× ×‘××§×•××•×ª ×©××™× × ×‘× ×™ ×ª×•×¨×”, ×•×¨×•×‘ ×”×§×”×œ ×”×™×• ×¢××™ ×”××¨×¥ ×©××©×—×§×™× ×©×™×—×” ×‘×˜×œ×” ×‘×‘×™×ª ×”×›× ×¡×ª ×‘×©×¢×ª ×—×–×¨×ª ×”×ª×¤×™×œ×”. × ×’×“ ×”×”×œ×›×” ×”×¤×¡×•×§×” ×‘×©×•×œ×—×Ÿ ×¢×¨×•×š. ××‘×œ ×œ×××™ ×©××”? ×œ×××™ ×”×•× ×›×•×ª×‘ ×•×‘×¡×•×£ ×“×‘×¨×™×• ××¡×™×™×, ×œ×¤×™ ×›×š, ×™×© ×œ× ×”×•×’ ×‘×›×œ ×”×§×”×™×œ×•×ª ×‘××¨×¥ ×™×©×¨××œ ×œ×¢×©×•×ª ×—×–×¨×” ×’× ×‘×ª×¤×™×œ×ª ××•×¡×£ ×©×œ ×©×‘×ª ×•×™×•× ×˜×•×‘, ×›×ª×§× ×ª ×—×–"×œ. ×•×××—×¨ ×©×× ×”×’ ×¨×•×‘ ×”×§×”×™×œ×•×ª ×‘××¨×¥ ×™×©×¨××œ ×œ×¢×©×•×ª ×—×–×¨×” ×›×“×™×Ÿ ×”×ª×œ××•×“, ×œ×›×Ÿ ××™×Ÿ ×œ×©× ×•×ª ××× ×”×’×™ ×™×¨×•×©×œ×™× ×•××¨×¥ ×™×©×¨××œ, ×›×™ ××¦×™×•×Ÿ ×ª×¦× ×ª×•×¨×” ×•×“×‘×¨ ×”×©× ××™×¨×•×©×œ×™×, ×•×œ× ×œ×‘×˜×œ. ××‘×œ ×¨×•××™× ×›××” ×—××•×¨ ×”×“×‘×¨ ×”×–×” ×©×—×©×‘×• ×œ×‘×˜×œ. ×—××•×¨ ×××•×“. ×¦×¨×™×š ×œ×”×™×–×”×¨. ×”×™×¦×¨ ×”×¨×¢ ×”×•× ×’×“×•×œ ×××•×“. ×¦×¨×™×›×™× ×œ×”×™×–×”×¨.

×™×© ×§×”×™×œ×•×ª ×©××‘×˜×œ×™× ××ª ×–×”? ×–×” ×‘×’×œ×œ ×©×”× ×××”×¨×™×. ×œ× ×‘×’×œ×œ ×©×”×“×™×‘×•×¨×™×. ××™×Ÿ ×œ×”× ×–××Ÿ ×œ×–×”. ×¤×¢× ×”×™×™×ª×™, ×”×™×”, ×”×™×” ×™×”×•×“×™ ××—×“ ×©××— ×©×œ×™ × ×™×¡×” ×œ×§×¨×‘ ××•×ª×•, ××• ××•×œ×™ ×§×™×¨×‘ ××•×ª×•, ×œ× ×™×•×“×¢ ×‘×“×™×•×§. ×‘×›×œ ××•×¤×Ÿ, ×”×•× ×¢×©×” ×‘×¨ ××¦×•×•×”, ×•×”×–××™×Ÿ ×’× ××•×ª× ×•. ××– ×”×œ×›×ª×™ ×¢× ××©×ª×™, ××‘×œ ×©×”×’×¢× ×• ×œ×©×, × ×›× ×¡× ×• ×¤× ×™××”, ×× ×—× ×• ×¨×•××™× ×©×–×” ×‘×™×ª ×›× ×¡×ª ×¨×¤×•×¨××™. ××– ×‘×¨×—× ×• ××©×. ××‘×œ ×‘×—×•×¥ ×”×™×” ×œ×•×— ××•×“×¢×•×ª. ××– ×”×™×” ××•×“×¢×” ×›×›×”, ×¢×§×‘ ××™×¢×•×˜ ×”××©×ª×ª×¤×™× ×‘×ª×¤×™×œ×•×ª ×œ×™×œ ×©×‘×ª, ×”×•×—×œ×˜ ×œ×‘×˜×œ ××ª ×”×ª×¤×™×œ×”. ×œ×’×‘×™ ×ª×¤×™×œ×•×ª ×©×œ ×©×‘×ª ×‘×‘×•×§×¨, ××‘×§×©×™× ×œ×¢×©×•×ª ×ª×•×¨× ×•×ª ×›×“×™ ×©×œ× × ×¦×˜×¨×š ×œ×‘×˜×œ ×’× ××ª ×–×”. ×–×” ××–×›×™×¨ ×œ×™ ××ª ××” ×©××ª×” ××•××¨, ×©×××”×¨×™×, ××– ××‘×˜×œ×™× ××ª ×”×—×–×¨×ª ×”×©"×¥.

×•×‘××• ×¢×œ×™×š ×›×œ ×”×‘×¨×›×•×ª ×”××œ×” ×•×”×©×™×’×•×š. ×œ××”? ××™×©×”×• ×‘×•×¨×— ××”×‘×¨×›×•×ª ×©×¦×¨×™×š ×œ×”×©×™×’ ××•×ª×•? ×•×‘××• ×¢×œ×™×š ×›×œ ×”×‘×¨×›×•×ª ×”××œ×” ×•×”×©×™×’×•×š. ××”, ×œ××Ÿ ×× ×™ ×‘×•×¨×—? ××‘×œ ×›××Ÿ ×–×” ×œ× ×›×‘×•×“, ×–×” ××“×•×‘×¨ ×¢×œ ×”×‘×¨×›×•×ª. ××£ ××—×“ ×œ× ××¡×¨×‘ ×œ×‘×¨×›×•×ª. ×™×© ×“×‘×¨ ×›×–×” ×©× ×§×¨×, ×©××“× ×™×© ×œ×• ×¤×ª××•× × ×¤×œ ×¢×œ×™×• × ×’×™×“ ××¤×¢×œ ×”×¤×™×¡. ×¤×ª××•× ×§×™×‘×œ ×”×¨×‘×” ×›×¡×£, ××‘×œ ××™×Ÿ ×œ×• ××” ×œ×¢×©×•×ª ×¢× ×–×”. ×œ××”? ×”×•× ×¨×•×¦×” ×œ× ×¡×•×¢ ×§×¦×ª ×œ×—×•×¥ ×œ××¨×¥, ×”×¨×•×¤× ×œ× ××¨×©×” ×œ×•, ×”×œ×‘ ×©×œ×• ×œ× ×‘×¡×“×¨, ×”×•× ×œ× ××¨×©×” ×œ×• ×œ×˜×¤×¡ ×¢× ×”××˜×•×¡. ×”×•× ×¨×•×¦×” ×œ××›×•×œ ××©×”×• ×˜×•×‘, ××•××¨ ×œ×• ×”×¨×•×¤× ×œ×, ×™×© ×œ×š ××•×œ×§×•×¡, ××œ ×ª××›×œ ××ª ×–×”. ×”×•× ×¨×•×¦×” ×–×”, ×œ×›×Ÿ ×”×•× ××•××¨ ×”×—×™×“×•×©×™ ×”×¨×™×™×, ×•×‘××• ×¢×œ×™×š ×›×œ ×”×‘×¨×›×•×ª ×”××œ×” ×•×”×©×™×’×•×š, ×©×–×” ×™×©×™×’ ××•×ª×š ×”×‘×¨×›×•×ª, ×©×™×”×™×” ×œ×š ××” ×œ×¢×©×•×ª ×¢× ×”×‘×¨×›×•×ª.`;

    // ××ª×§× ×™× ×¤×™×¡×•×§
    rawText = fixHebrewPunctuation(rawText);

    // ××—×œ×§×™× ×œ×¤×¡×§××•×ª ×œ×¤×™ ×©×•×¨×•×ª ×¨×™×§×•×ª ×‘×œ×‘×“
    const paragraphs = rawText
      .replace(/\r\n/g, '\n')
      .replace(/\n{3,}/g, '\n\n')
      .trim()
      .split(/\n\s*\n/)
      .filter(p => p.length > 0);

    const zip = new JSZip();
    const buffer = fs.readFileSync(templatePath);
    await zip.loadAsync(buffer);

    console.log('ğŸ“– ×™×•×¦×¨ ××¡××š ××˜×§×¡×˜ ×’×•×œ××™ ×¢×œ ×¤×¨×©×ª ×›×™ ×ª×‘×•×...');

    // ××ª×§× ×™× ×”×’×“×¨×•×ª ×©×¤×”
    if (zip.files['word/styles.xml']) {
      let stylesXml = await zip.file('word/styles.xml').async('string');
      stylesXml = stylesXml.replace(/w:val="ar-SA"/g, 'w:val="he-IL"');
      stylesXml = stylesXml.replace(/w:eastAsia="ar-SA"/g, 'w:eastAsia="he-IL"');
      stylesXml = stylesXml.replace(/w:bidi="ar-SA"/g, 'w:bidi="he-IL"');
      zip.file('word/styles.xml', stylesXml);
    }

    let documentXml = await zip.file('word/document.xml').async('string');

    const bodyStart = documentXml.indexOf('<w:body>') + '<w:body>'.length;
    const bodyEnd = documentXml.indexOf('</w:body>');

    let newBodyContent = '';
    paragraphs.forEach(paragraph => {
      newBodyContent += `
    <w:p w14:paraId="13B47B51" w14:textId="77777777" w:rsidR="007754CD" w:rsidRDefault="00E60846">
      <w:pPr>
        <w:jc w:val="right"/>
      </w:pPr>
      <w:r>
        <w:rPr>
          <w:lang w:val="he-IL" w:eastAsia="he-IL" w:bidi="he-IL"/>
        </w:rPr>
        <w:t>${escapeXml(paragraph)}</w:t>
      </w:r>
    </w:p>`;
    });

    const newDocumentXml = documentXml.substring(0, bodyStart) +
                          newBodyContent +
                          documentXml.substring(bodyEnd);

    zip.file('word/document.xml', newDocumentXml);

    const outBuffer = await zip.generateAsync({ type: 'nodebuffer' });
    fs.writeFileSync(outPath, outBuffer);

    console.log('âœ… ×™×¦×¨×ª×™ ××¡××š ××”×˜×§×¡×˜ ×”×’×•×œ××™:', outPath);
    console.log('ğŸ“Š ××¡×¤×¨ ×¤×¡×§××•×ª:', paragraphs.length);
    console.log('ğŸ“– ×”× ×•×©×: ×¤×¨×©×ª ×›×™ ×ª×‘×•× - ×‘×™×›×•×¨×™× ×•×“×™×‘×•×¨×™× ×‘×‘×™×ª ×”×›× ×¡×ª');
    console.log('ğŸ”§ ×”×’×“×¨×•×ª: ×¢×‘×¨×™×ª ×ª×§×™× ×” + ×™×™×©×•×¨ ×œ×™××™×Ÿ + ×¤×™×¡×•×§ ××ª×•×§×Ÿ');
    console.log('');
    console.log('ğŸ“ ×”×˜×§×¡×˜ ×”×’×•×œ××™ ×—×•×œ×§ ×œ-' + paragraphs.length + ' ×¤×¡×§××•×ª ×¢×œ ×‘×¡×™×¡ ×©×•×¨×•×ª ×¨×™×§×•×ª ×‘×œ×‘×“');
    console.log('ğŸ’¬ ×”×˜×§×¡×˜ ××›×™×œ ×“×™×‘×•×¨ ×™×©×™×¨, ×¦×™×˜×•×˜×™× ×•××¢×‘×¨×™× × ×•×©××™×™× ×˜×‘×¢×™×™×');

  } catch (error) {
    console.error('âŒ ×©×’×™××”:', error);
  }
}

createDocumentFromRawText();