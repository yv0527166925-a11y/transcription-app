// בדיקת בעיות פיסוק וצמידות גרשיים - גרסה מושלמת
function testPunctuationPerfect() {
  console.log('🧪 Testing punctuation issues with perfect logic...');

  const testCases = [
    'הוא אמר"אני הולך הביתה".',
    'הספר"תורה" נמצא על השולחן.',
    '"מה אתה אומר"שאל הרב.',
    'אמר"שלום."והלך.',
    'הם קראו"שמע ישראל".היום.',
    '"ברוך השם"אמר הילד.',
  ];

  testCases.forEach((testCase, index) => {
    console.log(`\\n--- Test ${index + 1} ---`);
    console.log('לפני:', testCase);

    let text = testCase;

    // שלב 1: תיקxxxxxxxxxxxxxחים צמודים למילה עברית (מילה"טקסט -> מילה "טקסט)
    text = text.replace(/([א-ת])"([א-ת])/g, '$1 "$2');

    // שלב 2: תיקון גרשיים סוגרים צמודים למילה הבאה (אבל רק אם באמת גרשיים סוגרים)
    // זיהוי גרשיים סוגרים על ידי הקשר: אם יש מילה עברית לפני הגרשיים
    // ואחרי הגרשיים מיד מילה עברית, זה כנראה גרשיים סוגרים
    text = text.replace(/([א-ת])"([א-ת])/g, '$1" $2');

    // שלב 3: תיקון נקודה במקום הלא נכון (מילה." -> מילה".)
    text = text.replace(/([א-ת])\\."/g, '$1".');

    // שלב 4: הוספת רווח אחרי נקודה+גרשיים (.מילה -> . מילה)
    text = text.replace(/"\\.([א-ת])/g, '". $1');

    // שלב 5: הוספת רווח אחרי פיסוק+גרשיים (,מילה -> , מילה וכו')
    text = text.replace(/"([.,!?:;])([א-ת])/g, '"$1 $2');

    // נקה רווחים מיותרים
    text = text.replace(/\\s{2,}/g, ' ');

    console.log('אחרי:', text);

    // הציג מה היינו מצפים לקבל
    const expected = [
      'הוא אמר "אני הולך הביתה".',
      'הספר "תורה" נמצא על השולחן.',
      '"מה אתה אומר" שאל הרב.',
      'אמר "שלום". והלך.',
      'הם קראו "שמע ישראל". היום.',
      '"ברוך השם" אמר הילד.',
    ];

    console.log('ציפיה:', expected[index]);
    console.log('✅ תקין:', text === expected[index] ? 'כן' : 'לא');
  });
}

testPunctuationPerfect();