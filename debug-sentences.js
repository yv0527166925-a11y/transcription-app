const text = `אתם ניצבים היום כולכם לפני השם אלוקיכם, ראשיכם שבטיכם זקניכם ושוטריכם כל איש ישראל. אומר הזוהר הקדוש, מה זה "היום"? היום זהו יום הדין, ראש השנה. לא יהיה יהודי שלא יגיע בראש השנה לפני הקדוש ברוך הוא. ראשיכם, שבטיכם, טפכם, חוטב עצך, שואב מימך, כל איש ישראל.

ולכל אחד ידון אותו שני דינים: הדין הפרטי על מה שהוא עשה, ומה הייתה ההשפעה שלו על האחרים. אם הוא גרם חיזוק, גרם תועלת לאנשים שיקיימו עוד מצוות, או חס ושלום גרם רפיון או נפילה גם לאחרים.
זה הדבר. היו שני בעלי מעלה שישבו ביחד לפני יום הדין ולמדו מוסר, ופרצו בבכי. ואז אחד שואל את חברו, "מדוע אתה בוכה?" הוא אומר לו, "אני בוכה על העבירות שעשיתי. מה יהיה איתי? איך אני אעבור איתם את יום הדין?"

אמר לו השני: "אני על העבירות לא בוכה. יש לנו מתנה ששמה תשובה". פרשת השבוע, "ושבת עד השם אלוקיך". אני יכול לשוב בתשובה והשם ירחם עליי, ימחול לי על כל העוונות. אתה יודע על מה אני בוכה? על המצוות שעשיתי. המצוות שעשיתי, פה המצווה הייתה חסרה, פה המצווה הייתה פגומה, והם יישארו פגומות לנצח.
המלכים, אומרים חז"ל ב"ונתנה תוקף", אומרים "יחפזון". למה הם יחפזון? מה, המלאכים עשו עבירה? יש להם יצר הרע? זה אותם מלאכים שנבראו מן המצוות שלנו, והם פגומים, אז הם עוברים מהר, הם מתביישים להיראות לפני הקדוש ברוך הוא כשהם פגומים. "ומלאכים יחפזון".`;

console.log('🔍 Debugging sentence splitting and punctuation before "אמר לו השני"...\n');

const sentences = text.split(/(?<=[.!?])\s+/).filter(s => s.trim().length > 0);

sentences.forEach((sentence, i) => {
  console.log(`${i + 1}. "${sentence}"`);

  if (sentence.includes('אמר לו השני')) {
    console.log('   ⭐ זה המשפט עם "אמר לו השני"!');

    // בדיקה של המשפט הקודם
    if (i > 0) {
      const prevSentence = sentences[i - 1];
      console.log(`   📝 המשפט הקודם: "${prevSentence}"`);

      // בדיקת סיום בגרשיים/סימן שאלה/סימן קריאה
      const endsWithPunctuation = prevSentence.match(/["\?!]"?$/);
      console.log(`   🔍 מסתיים בסימן פיסוק מיוחד: ${endsWithPunctuation ? 'כן' : 'לא'}`);
      if (endsWithPunctuation) {
        console.log(`   ✅ נמצא סימן: "${endsWithPunctuation[0]}"`);
      }
    }
  }
});

console.log(`\nTotal sentences: ${sentences.length}`);