const fs = require('fs');
const path = require('path');

// ×˜×§×¡×˜ ×“×•×’××” ××¨×•×š ×™×•×ª×¨ ×©××“××” ×¤×œ×˜ ××’××™× ×™ ×¢× ×¤×¡×§××•×ª ×™×¤×•×ª ××‘×œ ××¨×•×›×•×ª
const sampleTranscription = `×©×œ×•× ×•×‘×¨×›×”, ×”×™×•× ×× ×™ ×¨×•×¦×” ×œ×“×‘×¨ ×¢×œ × ×•×©× ×—×©×•×‘ ×××•×“ ×©××¢×¡×™×§ ××•×ª×™ ×›×‘×¨ ×–××Ÿ ×¨×‘. ×× ×™ ×—×•×©×‘ ×©×–×” ××©×”×• ×©×›×•×œ× ×• ×¦×¨×™×›×™× ×œ×—×©×•×‘ ×¢×œ×™×• ×•×œ×”×ª×™×™×—×¡ ××œ×™×• ×‘×¨×¦×™× ×•×ª. ×–×” ×œ× ××©×”×• ×©××¤×©×¨ ×¤×©×•×˜ ×œ×”×ª×¢×œ× ××× ×• ××• ×œ×“×—×•×ª ×œ×–××Ÿ ××—×¨. ×× ×—× ×• ×¦×¨×™×›×™× ×œ×”×ª×™×™×—×¡ ×œ×–×” ×¢×›×©×™×•, ×‘×¨×’×¢ ×”×–×”, ×›×™ ×”×–××Ÿ ×¢×•×‘×¨ ×•×”××¦×‘ ×œ× ××—×›×” ×œ××£ ××—×“. ×× ×œ× × ×¤×¢×œ ×¢×›×©×™×•, ×× ×—× ×• ×¢×œ×•×œ×™× ×œ×¤×¡×¤×¡ ×”×–×“×× ×•×™×•×ª ×—×©×•×‘×•×ª ×©×œ× ×™×—×–×¨×• ×¢×•×“ ×¤×¢×. ×× ×™ ×™×•×“×¢ ×©×–×” × ×©××¢ ×“×¨××˜×™, ××‘×œ ×–×” ×‘×××ª ×›×š.

×‘×¢×¦×, ×›×©×× ×™ ××¡×ª×›×œ ×¢×œ ×”××¦×‘ ×”× ×•×›×—×™, ×× ×™ ×¨×•××” ×©×™×© ×›××Ÿ ×”×–×“×× ×•×ª ×××™×ª×™×ª ×œ×¢×©×•×ª ×©×™× ×•×™ ××©××¢×•×ª×™. ×œ× ××“×•×‘×¨ ×‘×“×‘×¨ ×§×˜×Ÿ ××• ×©×•×œ×™, ××œ× ×‘×××ª ×‘××©×”×• ×©×™×›×•×œ ×œ×”×©×¤×™×¢ ×¢×œ ×›×•×œ× ×• ×‘×˜×•×•×— ×”××¨×•×š. ×™×© ×›××Ÿ ×¤×•×˜× ×¦×™××œ ×¢×¦×•× ×œ×¢×©×•×ª ×“×‘×¨×™× ×©×•× ×™×, ×œ×—×©×•×‘ ××—×•×¥ ×œ×§×•×¤×¡×”, ×•×œ××¦×•× ×¤×ª×¨×•× ×•×ª ×™×¦×™×¨×ª×™×™× ×œ×‘×¢×™×•×ª ×©× ×¨××•×ª ×‘×œ×ª×™ ×¤×ª×™×¨×•×ª. ×× ×™ ××××™×Ÿ ×©×× × ×ª×××¥ ××¡×¤×™×§ ×•× ×”×™×” ××•×›× ×™× ×œ×§×—×ª ×¡×™×›×•× ×™× ××—×•×©×‘×™×, × ×•×›×œ ×œ×”×’×™×¢ ×œ××§×•××•×ª ×©×œ× ×—×œ×× ×• ×¢×œ×™×”×. ×–×” ×“×•×¨×© ××•××¥, × ×—×™×©×•×ª, ×•×’× ×§×¦×ª ××–×œ, ××‘×œ ×–×” ×‘×”×—×œ×˜ ××¤×©×¨×™.

×× ×™ ×–×•×›×¨ ×©×¤×¢×, ×œ×¤× ×™ ×›××” ×©× ×™×, ×”×™×ª×” ×œ×™ ×—×•×•×™×” ×××•×“ ××¢× ×™×™× ×ª ×©××œ××“×ª ×‘×“×™×•×§ ×¢×œ ×”× ×•×©× ×”×–×”. ×”×™×™×ª×™ ×‘××§×•× ××¡×•×™×, ×¤×’×©×ª×™ ×× ×©×™× ××¡×•×™××™×, ×•×¤×ª××•× ×”×‘× ×ª×™ ××©×”×• ×©×œ× ×”×‘× ×ª×™ ×§×•×“×. ×–×” ×”×™×” ×›××• ×”××¨×”, ×¨×’×¢ ×©×œ ×‘×”×™×¨×•×ª ××•×—×œ×˜×ª ×©×‘×• ×”×›×œ ×”×¡×ª×“×¨ ×‘××§×•×. ×œ×¤× ×™ ×›×Ÿ ×—×©×‘×ª×™ ×©×× ×™ ××‘×™×Ÿ ××ª ×”××¦×‘, ××‘×œ ×”×‘× ×ª×™ ×©×× ×™ ×‘×›×œ×œ ×œ× ×”×‘× ×ª×™ ×›×œ×•×. ×–×” ×”×™×” ×§×¦×ª ××‘×œ×‘×œ ×‘×”×ª×—×œ×”, ××‘×œ ×’× ×××•×“ ××¢×¦×™×. ×–×” ×”×¨××” ×œ×™ ×©×ª××™×“ ×™×© ××” ×œ×œ××•×“, ×ª××™×“ ×™×© ×“×¨×›×™× ×—×“×©×•×ª ×œ×”×¡×ª×›×œ ×¢×œ ×“×‘×¨×™×, ×•×ª××™×“ ×™×© ××§×•× ×œ×¦××™×—×” ×•×œ×”×ª×¤×ª×—×•×ª.

×”×©××œ×” ×”×—×©×•×‘×” ×”×™× ××” ×× ×—× ×• ×¢×•×©×™× ×¢× ×”×”×‘× ×” ×”×–×•. ××™×š ×× ×—× ×• ××ª×¨×’××™× ××ª ×–×” ×œ×¤×¢×•×œ×” ×§×•× ×§×¨×˜×™×ª. ×›×™ ×‘×¡×•×£, ×”×¨×¢×™×•× ×•×ª ×”×›×™ ×™×¤×™× ×œ× ×©×•×•×™× ×›×œ×•× ×× ×× ×—× ×• ×œ× ××‘×™××™× ××•×ª× ×œ×‘×™×¦×•×¢. ×¦×¨×™×š ×œ×”×™×•×ª ×ª×•×›× ×™×ª, ×¦×¨×™×š ×œ×”×™×•×ª ××¡×’×¨×ª, ×•×¦×¨×™×š ×œ×”×™×•×ª ××™×©×”×• ×©××—×¨××™ ×¢×œ ×”×”×•×¦××” ×œ×¤×•×¢×œ. ×‘×œ×™ ×–×”, ×”×›×œ × ×©××¨ ×‘×¨××” ×”×ª×™××•×¨×˜×™×ª, ×•×‘×¡×•×£ ×œ× ×§×•×¨×” ×›×œ×•×. ×× ×™ ×œ××“×ª×™ ××ª ×–×” ×¢×œ ×‘×©×¨×™, ×›×™ ×”×™×• ×œ×™ ×”×¨×‘×” ×¨×¢×™×•× ×•×ª ××¢×•×œ×™× ×©××¢×•×œ× ×œ× ×™×¦××• ×œ×¤×•×¢×œ, ×‘×“×™×•×§ ×‘×’×œ×œ ×©×œ× ×”×™×” ××™ ×©×™×™×§×— ××—×¨×™×•×ª ×¢×œ ×”×”×•×¦××” ×œ×¤×•×¢×œ.`;

// ×’× ×˜×§×¡×˜ ×¢× ×‘×¢×™×™×ª ×—×–×¨×•×ª ×œ×“×•×’××”
const transcriptionWithRepetitions = `×”×™×•× ×× ×™ ×¨×•×¦×” ×œ×“×‘×¨ ×¢×œ- ×–×” ×”×™×” × ×•×©× ××—×¨, e, ×–×” ×”×™×” × ×•×©× ××—×¨, ×–×” ×”×™×” × ×•×©× ××—×¨ ×©××¢× ×™×™×Ÿ ××•×ª×™ ×××•×“. ×× ×™ ×—×•×©×‘ ×©×–×”- ×–×” ×‘×××ª- ×–×” ×‘×××ª ××©×”×• ×©×›×•×œ× ×• ×¦×¨×™×›×™× ×œ×©××•×¢ ×¢×œ×™×•.

×”× ×§×•×“×” ×”×—×©×•×‘×” ×”×™× ×©×× ×—× ×• ×¦×¨×™×›×™× ×œ×”×‘×™×Ÿ ××ª- ××ª ×”× ×•×©× ×”×–×” ×‘×¦×•×¨×” ××¢××™×§×”. ×›×™ ×‘×œ×™ ×”×‘× ×” × ×›×•× ×” ×× ×—× ×• ×œ× × ×•×›×œ ×œ×”×ª×§×“× ×•×œ×¢×©×•×ª ××ª ××” ×©×¦×¨×™×š ×œ×¢×©×•×ª. ×–×” ×¤×©×•×˜ ×œ× ××¤×©×¨×™.`;

// ×¤×•× ×§×¦×™×” ×¤×©×•×˜×” ×©××¨××” ××™×š ×™×¨××” ×”×˜×§×¡×˜ ××—×¨×™ createShortParagraphs
function simulateCurrentProcessing(text) {
  console.log('ğŸ“ Original paragraphs:');
  const originalParagraphs = text.split(/\n\s*\n/);
  originalParagraphs.forEach((p, i) => {
    console.log(`${i + 1}. "${p.substring(0, 100)}..."`);
  });

  console.log('\nğŸ”§ After createShortParagraphs processing:');

  // ××“××” ××ª ×”×œ×•×’×™×§×” × createShortParagraphs
  const words = text.replace(/\n\s*\n/g, ' ').split(/\s+/);
  const paragraphs = [];
  let currentParagraph = '';
  let wordCount = 0;

  for (let i = 0; i < words.length; i++) {
    const word = words[i];
    currentParagraph += word + ' ';
    wordCount++;

    const endsWithPunctuation = word.match(/[.!?]$/);
    const nextWord = i < words.length - 1 ? words[i + 1] : '';

    // ×ª× ××™ ×”×¤×™×¦×•×œ ×”××§×•×¨×™×™×
    const shouldBreak =
      wordCount >= 50 ||
      (endsWithPunctuation && wordCount >= 25) ||
      (endsWithPunctuation && wordCount >= 30 && nextWord.match(/^[×-×ª]/));

    if (shouldBreak) {
      paragraphs.push(currentParagraph.trim());
      currentParagraph = '';
      wordCount = 0;
    }
  }

  if (currentParagraph.trim().length > 0) {
    paragraphs.push(currentParagraph.trim());
  }

  paragraphs.forEach((p, i) => {
    console.log(`${i + 1}. "${p.substring(0, 100)}..."`);
  });

  return paragraphs;
}

async function testWordGeneration() {
  try {
    console.log('ğŸ§ª Testing current Word document processing...');
    console.log('ğŸ“ Sample text has', sampleTranscription.split(/\n\s*\n/).length, 'paragraphs originally');

    const processedParagraphs = simulateCurrentProcessing(sampleTranscription);

    console.log(`\nğŸ“Š Result: ${sampleTranscription.split(/\n\s*\n/).length} original paragraphs â†’ ${processedParagraphs.length} processed paragraphs`);
    console.log('âŒ Problem: The createShortParagraphs function is breaking up the nice AI-generated paragraphs!');

  } catch (error) {
    console.error('âŒ Error in test:', error);
  }
}

// ×‘×“×™×§×” ×× ×–×” ××•×¤×¢×œ ×™×©×™×¨×•×ª
if (require.main === module) {
  testWordGeneration();
}

module.exports = { testWordGeneration };